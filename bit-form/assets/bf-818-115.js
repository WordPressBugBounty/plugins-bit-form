var F=Object.defineProperty;var v=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var R=(a,t,r)=>t in a?F(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,f=(a,t)=>{for(var r in t||(t={}))E.call(t,r)&&R(a,r,t[r]);if(v)for(var r of v(t))U.call(t,r)&&R(a,r,t[r]);return a};import{_ as d,ae as A,$ as I,c as w,A as W,ca as H,r as y,u as P,j as l,C as N}from"./main-861.js";import{t as D}from"./bf-914-82.js";import{a4 as G,a5 as O,a6 as q}from"./bf-729-81.js";const Z=(a,t,r,n,c,e,s,i,o)=>{let h=f({},t);if(s){const p=f({},i);p[a.target.name]="",o(f({},p))}switch(h[a.target.name]=a.target.value,a.target.name){case"spreadsheetId":h=M(h,n,r,c,e);break;case"worksheetName":h=V(h,n,r,c,e);break}r(f({},h))},M=(a,t,r,n,c)=>{var s,i,o,h,p,m,g,k,u;const e=W(a);return e.worksheetName="",e.headerRow="A1",e.field_map=[{formField:"",googleSheetField:""}],(i=(s=e==null?void 0:e.default)==null?void 0:s.worksheets)!=null&&i[a.spreadsheetId]?Object.keys((h=(o=e==null?void 0:e.default)==null?void 0:o.worksheets)==null?void 0:h[a.spreadsheetId]).length===1&&(e.worksheetName=(m=(p=e==null?void 0:e.default)==null?void 0:p.worksheets)==null?void 0:m[a.spreadsheetId][0].properties.title,(u=(k=(g=e==null?void 0:e.default)==null?void 0:g.worksheets)==null?void 0:k.headers)!=null&&u[e.worksheetName]||z(t,e,r,n,c)):B(t,e,r,n,c),e},V=(a,t,r,n,c)=>{var s,i,o;const e=f({},a);return e.headerRow="A1",e.field_map=[{formField:"",googleSheetField:""}],(o=(i=(s=e==null?void 0:e.default)==null?void 0:s.worksheets)==null?void 0:i.headers)!=null&&o[a.worksheetName]||z(t,e,r,n,c),e},C=(a,t,r,n,c)=>{n(!0);const e={formID:a,id:t.id,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails,ownerEmail:t.ownerEmail};w(e,"bitforms_gsheet_refresh_spreadsheets").then(s=>{if(s&&s.success){const i=f({},t);i.default||(i.default={}),s.data.spreadsheets&&(i.default.spreadsheets=s.data.spreadsheets),s.data.tokenDetails&&(i.tokenDetails=s.data.tokenDetails),c({show:!0,msg:d("Spreadsheet refreshed")}),r(f({},i))}else s&&s.data&&s.data.data||!s.success&&typeof s.data=="string"?c({show:!0,msg:H(d("Spreadsheet refresh failed Cause: %s. please try again"),s.data.data||s.data)}):c({show:!0,msg:d("Spreadsheet refresh failed. please try again")});n(!1)}).catch(()=>n(!1))},B=(a,t,r,n,c)=>{const{spreadsheetId:e}=t;if(!e)return;n(!0);const s={formID:a,spreadsheetId:e,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails};w(s,"bitforms_gsheet_refresh_worksheets").then(i=>{if(i&&i.success){const o=f({},t);i.data.worksheets&&(o.default.worksheets||(o.default.worksheets={}),o.default.worksheets[e]=i.data.worksheets),i.data.tokenDetails&&(o.tokenDetails=i.data.tokenDetails),c({show:!0,msg:d("Worksheets refreshed")}),r(f({},o))}else c({show:!0,msg:d("Worksheets refresh failed. please try again")});n(!1)}).catch(()=>n(!1))},z=(a,t,r,n,c)=>{const{spreadsheetId:e,worksheetName:s,header:i,headerRow:o}=t;if(!e&&!s&&!i&&!o)return;n(!0);const h={formID:a,spreadsheetId:e,worksheetName:s,header:i,headerRow:o,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails};w(h,"bitforms_gsheet_refresh_worksheet_headers").then(p=>{var m;if(p&&p.success){const g=f({},t);((m=p.data.worksheet_headers)==null?void 0:m.length)>0?(g.default.headers||(g.default.headers={}),g.default.headers[e]||(g.default.headers[e]={}),g.default.headers[e][s]||(g.default.headers[e][s]={}),g.default.headers[e][s][o]=p.data.worksheet_headers,p.data.tokenDetails&&(g.tokenDetails=p.data.tokenDetails),c({show:!0,msg:d("Worksheet Headers refreshed")})):c({show:!0,msg:d("No Worksheet headers found. Try changing the header row number or try again")}),p.data.tokenDetails&&(g.tokenDetails=p.data.tokenDetails),r(f({},g))}else c({show:!0,msg:d("Worksheet Headers refresh failed. please try again")});n(!1)}).catch(()=>n(!1))},J=(a,t,r,n,c,e)=>{if(!a.clientId||!a.clientSecret){r({clientId:a.clientId?"":d("Client ID cann't be empty"),clientSecret:a.clientSecret?"":d("Secret key cann't be empty")});return}c(!0);const s="https://www.googleapis.com/auth/drive",i=A(I),o=`https://accounts.google.com/o/oauth2/v2/auth?scope=${s}&access_type=offline&prompt=consent&response_type=code&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(i.googleRedirectURL)}&client_id=${a.clientId}`,h=window.open(o,"googleSheet","width=400,height=609,toolbar=off"),p=setInterval(()=>{if(h.closed){clearInterval(p);let m={},g=!1;const k=localStorage.getItem("__bitforms_googleSheet");if(k&&(g=!0,m=JSON.parse(k),localStorage.removeItem("__bitforms_googleSheet")),!m.code||m.error||!m||!g){const u=m.error?`Cause: ${m.error}`:"";e({show:!0,msg:`${d("Authorization failed")} ${u}. ${d("please try again")}`}),c(!1)}else{const u=f({},a);u.accountServer=m["accounts-server"],T(m,u,t,n,c,e)}}},500)},T=(a,t,r,n,c,e)=>{const s=f({},a);s.clientId=t.clientId,s.clientSecret=t.clientSecret;const i=A(I);s.redirectURI=i.googleRedirectURL,w(s,"bitforms_gsheet_generate_token").then(o=>o).then(o=>{if(o&&o.success){const h=f({},t);h.tokenDetails=o.data,r(h),G(h),n(!0),e({show:!0,msg:d("Authorized Successfully")})}else o&&o.data&&o.data.data||!o.success&&typeof o.data=="string"?e({show:!0,msg:`${d("Authorization failed Cause:")}${o.data.data||o.data}. ${d("please try again")}`}):e({show:!0,msg:d("Authorization failed. please try again")});c(!1)})},ee=a=>!((a.field_map?a.field_map.filter(r=>!r.formField&&!r.googleSheetField):[]).length>0);function K({formID:a,sheetConf:t,setSheetConf:r,step:n,setstep:c,isLoading:e,setisLoading:s,setSnackbar:i,redirectLocation:o,isInfo:h,authorizedAction:p}){const[m,g]=y.useState(!1),[k,u]=y.useState({clientId:"",clientSecret:""}),j=P(I),{siteURL:$}=j,_=x=>{const S=f({},t),b=f({},k);b[x.target.name]="",S[x.target.name]=x.target.value,u(b),r(S)};return y.useEffect(()=>{m&&p()},[m]),l.jsxs(l.Fragment,{children:[l.jsx(O,{title:D.googelSheets.title,youTubeLink:D.googelSheets.link}),l.jsxs("div",{className:"btcd-stp-page",style:{width:900,height:"100%"},children:[l.jsx("div",{className:"mt-3",children:l.jsx("b",{children:d("Integration Name:")})}),l.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:_,name:"name",value:t.name,type:"text",placeholder:d("Integration Name..."),disabled:h}),l.jsx("div",{className:"mt-3",children:l.jsx("b",{children:d("Homepage URL:")})}),l.jsx(N,{value:$,className:"field-key-cpy w-6 ml-0",readOnly:h}),l.jsx("div",{className:"mt-3",children:l.jsx("b",{children:d("Authorized Redirect URIs:")})}),l.jsx(N,{value:o||`${j.googleRedirectURL}`,className:"field-key-cpy w-6 ml-0",readOnly:h}),l.jsxs("small",{className:"d-blk mt-5",children:[d("To get Client ID and SECRET , Please Visit")," ",l.jsx("a",{className:"btcd-link",href:"https://console.developers.google.com/apis/credentials",target:"_blank",rel:"noreferrer",children:d("Google API Console")})]}),l.jsx("div",{className:"mt-3",children:l.jsx("b",{children:d("Client id:")})}),l.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:_,name:"clientId",value:t.clientId,type:"text",placeholder:d("Client id..."),disabled:h}),l.jsx("div",{style:{color:"red",fontSize:"15px"},children:k.clientId}),l.jsx("div",{className:"mt-3",children:l.jsx("b",{children:d("Client secret:")})}),l.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:_,name:"clientSecret",value:t.clientSecret,type:"text",placeholder:d("Client secret..."),disabled:h}),l.jsx("div",{style:{color:"red",fontSize:"15px"},children:k.clientSecret}),!h&&l.jsxs(l.Fragment,{children:[l.jsx(q,{isAuthorized:m,isLoading:e,handleAuthorize:()=>J(t,r,u,g,s,i)}),l.jsx("br",{})]})]})]})}var te=Object.freeze({__proto__:null,default:K});export{K as G,B as a,z as b,ee as c,te as d,Z as h,C as r};
